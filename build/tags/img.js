define(["jquery","value","helpers","hook","template","loadImage"],function(a,b,c,d,e,f){function g(g){this.hidden=g.hidden,this.data=b({}),this.inputId=_.uniqueId("gofer"),this.imgId=_.uniqueId("gofer"),this.src=b(""),this.src.subscribe(_.bind(function(a){this.data.update("src",a)},this)),this.title=b(),this.title.subscribe(_.bind(function(a){this.data.update("title",a)},this))(g.title),g.mix&&this.data.modify(c(g.mix)),this.note=g.note,g.required&&d("submit",_.bind(function(){return this.src()},this)),d("dom",_.bind(function(b){var c=a("#"+this.imgId);b.on("change","#"+this.inputId,function(a){f(a.target.files[0],function(a){c.html(a)})})},this)),e("img",'<% if(note) { %><div class="gofer-note"><%= note %></div><% } %><div id="<%= imgId %>"></div><input type="file" accept="image/*" id="<%= inputId %>">')}return _.extend(g.prototype,{edit:function(a){return e("img",this)},view:function(){return this.hidden?"":'<img src="'+this.src()+'">'}}),g})