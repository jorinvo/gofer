(function(){var requirejs,require,define;(function(a){function g(a,b){if(a&&a.charAt(0)==="."&&b){b=b.split("/"),b=b.slice(0,b.length-1),a=b.concat(a.split("/"));var c,d;for(c=0;d=a[c];c++)if(d===".")a.splice(c,1),c-=1;else if(d===".."){if(c===1&&(a[2]===".."||a[0]===".."))break;c>0&&(a.splice(c-1,2),c-=2)}a=a.join("/")}return a}function h(b,c){return function(){return f.apply(a,d.call(arguments,0).concat([b,c]))}}function i(a){return function(b){return g(b,a)}}function j(a){return function(c){b[a]=c}}function k(d){if(c.hasOwnProperty(d)){var f=c[d];delete c[d],e.apply(a,f)}return b[d]}function l(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=g(a.slice(0,e),b),a=a.slice(e+1),d=k(c),d&&d.normalize?a=d.normalize(a,i(b)):a=g(a,b)):a=g(a,b),{f:c?c+"!"+a:a,n:a,p:d}}var b={},c={},d=[].slice,e,f;if(typeof define=="function")return;e=function(d,e,f,g){var i=[],m,n,o,p,q,r;g||(g=d);if(typeof f=="function"){!e.length&&f.length&&(e=["require","exports","module"]);for(p=0;p<e.length;p++){r=l(e[p],g),o=r.f;if(o==="require")i[p]=h(d);else if(o==="exports")i[p]=b[d]={},m=!0;else if(o==="module")n=i[p]={id:d,uri:"",exports:b[d]};else if(b.hasOwnProperty(o)||c.hasOwnProperty(o))i[p]=k(o);else{if(!r.p)throw d+" missing "+o;r.p.load(r.n,h(g,!0),j(o),{}),i[p]=b[o]}}q=f.apply(b[d],i),d&&(n&&n.exports!==a?b[d]=n.exports:m||(b[d]=q))}else d&&(b[d]=f)},requirejs=f=function(b,c,d,g){return typeof b=="string"?k(l(b,c).f):(b.splice||(c.splice?(b=c,c=arguments[2]):b=[]),g?e(a,b,c,d):setTimeout(function(){e(a,b,c,d)},15),f)},f.config=function(){return f},require||(require=f),define=function(a,b,d){b.splice||(d=b,b=[]),define.unordered?c[a]=[a,b,d]:e(a,b,d)},define.amd={jQuery:!0}})(),define("../libs/almond",function(){}),define("parser",[],function(){function a(a,b){function c(d,e){var f=a.pop();return _.isUndefined(f)?"":f.isClosingTag?c(f.name,[]):d?d===f.name?c()+f.object[b](function(){return _.reduce(e,function(a,c){return a+(_.isString(c)?c:c.object[b].call(c.object))},"")}):(e.unshift(f),c(d,e)):c()+(_.isString(f)?f:f.object[b]())}return c().replace("{\\{","{{").replace("}\\}","}}")}return a}),define("template",[],function(){function b(){var b=arguments;if(_.isUndefined(b[0]))return _.keys(a);if($.isPlainObject(b[0])){var c=b[0];if(_.isString(_.values(c)[0])){_.each(c,function(a,b){c[b]=_.template(a)}),_.extend(a,c);return}return _.each(c,function(b,d){c[d]=a[d](b)}),c}if(_.isObject(b[1]))return a[b[0]](b[1]);if(_.isUndefined(b[1]))return a[b[0]];a[b[0]]=_.template(b[1]);if(b[2])return a[b[0]](b[2])}var a={};return b}),define("manage",[],function(){function a(a,b){var c=_.reject(a,function(a){return a===b});return c.length===a.length?a.push(b):a=c,a}return a}),define("value",["manage"],function(a){function b(b){function f(a){return _.isUndefined(a)||(c=a,h()),g()}function g(){return _.compose.apply(this,d)(c)}function h(){var a=g();_.each(e,function(b){b(a)})}var c=b,d=[],e=[];return _.extend(f,{modify:function(b){return d=a(d,b),this},subscribe:function(b){return e=a(e,b),this},trigger:function(){return h(),this},update:function(a){var b=arguments;return _.isArray(c)?b.length===2&&(_.isNumber(b[0])||_.isNumber(parseInt(b[0],10)))?c[b[0]]=b[1]:c=c.concat(_.isArray(a)?a:Array.prototype.slice.call(b)):_.isObject(c)?_.isUndefined(b[1])?_.isArray(a)?c[a[0]]=a[1]:_.extend(c,a):c[b[0]]=b[1]:c+=a,h(),this}}),f}return b}),define("hook",["manage"],function(a){function c(d,e){if(_.isFunction(e))return b[d]=b[d]?a(b[d],e):[e],c;var f=!0;return _.each(b[d],function(a){a(e)||(f=!1)}),f}var b={};return c}),define("helpers",[],function(){function a(a){if(!$.isPlainObject(a))return b[a];_.defaults(b,a)}var b={};return a.overwrite=function(a){_.extend(b,a)},a}),define("tags",[],function(){var a={register:function(b){a.cache=_.defaults(a.cache,b)},cache:{}};return a}),define("id",["value","template","hook","tags"],function(a,b,c,d){function e(d){this.data=a(),e.subscribe(d,_.bind(this.data,this)),this.id=_.uniqueId("gofer"),c("dom",_.bind(function(){var a=$("."+this.id).html(this.content());this.data.subscribe(_.bind(function(){$("."+this.id).html(this.content())},this))},this)),b("id",'<div class="<%= id %>"></div>')}function g(){}_.extend(e.prototype,{edit:function(a){return a?this.content=function(){return _.reduce(this.data(),function(b,c){return b+a().replace(/\{\{el\}\}/,c)},"")}:this.content=function(){return _.reduce(this.data(),function(a,b){return a+b},"")},b("id",this)},view:function(a){return this.content()}}),e.cache={};var f=function(a){e.cache[a]={data:function(){return _.map(this.objects,function(a){return a()},this)},objects:[],observers:[]}};return e.subscribe=function(a,b){e.cache[a]?b(e.cache[a].data()):f(a),e.cache[a].observers.push(b)},e.trigger=function(a,b){var c=e.cache[a].data();_.each(e.cache[a].observers,function(a){a(c,b)})},e.add=function(a,b){e.cache[a]||f(a);var c=e.cache[a].objects.push(b)-1;b.subscribe(function(b){e.trigger(a,c)}),e.trigger(a,c)},e.update=function(a,b,c){e.cache[a].objects[b](c),e.trigger(a,b)},_.extend(g.prototype,{edit:function(){return"{{el}}"},view:function(){return"{{el}}"}}),d.register({el:g}),e}),define("lexer",["id","tags"],function(a,b){function c(c){return _.map(c.split(/\{\{|\}\}/),function(c,d){if(d%2!==0){var e={temp:$.trim(c)},f={},g=e.temp.match(/\S+\(.*?\)|\S+=".*?"|\S+/g),h,i;e.name=g.shift();var j=e.name.match(/(.+?)\((.*?)\)/);if(h=e.name.match(/\/(.+)/))return e.isClosingTag=!0,e.name=h[1],e;if(i=e.name.match(/#(.+)/))return e.isId=!0,e.name=i[1],e.object=new a(e.name),e;j&&(e.name=j[1],f.param=j[2]),f.htmlAttributes="";var k;return _.each(g,function(a){var b;if(/#(.+)/.test(a))return k=a.match(/#(.+)/)[1];(b=a.match(/(.+?)\((.*?)\)/))?f[b[1]]=b[2]:/.+?".*?"/.test(a)?f.htmlAttributes+=" "+a:f[a]=!0}),e.object=new b.cache[e.name](f),k&&a.add(k,e.object.data),e}return c})}return c}),define("tags/input",["value","helpers","hook","template"],function(a,b,c,d){function e(e){this.id=_.uniqueId("gofer"),this.data=a(e.data),this.data.modify(_.escape),this.dataOut=e.mix?function(){return b(e.mix)(this.data())}:this.data,this.hidden=e.hidden,this.note=e.note,e.required&&c("submit",_.bind(function(){return this.data()},this)),c("dom",_.bind(function(){var a=$("#"+this.id).on("keyup",_.bind(function(){this.data(a.val())},this));this.data.subscribe(function(b){a.val(b)}),a.val(this.data())},this)),d("input",'<% if(note) { %>  <label class="gofer"><%= note %></label><% } %><input type="text" id="<%= id %>" class="gofer">')}return _.extend(e.prototype,{edit:function(){return d("input",this)},view:function(){return this.hidden?"":this.dataOut()}}),e}),define("tags/note",[],function(){function a(){}return _.extend(a.prototype,{edit:function(a){return a()},view:function(){return""}}),a}),define("loadImage",[],function(){function a(a,b){var f=document.createElement("img"),g,h;return f.onerror=b,f.onload=function(){h&&d(h),b(f)},window.File&&a instanceof File?g=h=c(a):g=a,g?(f.src=g,f):e(a,function(a){f.src=a})}function c(a){return b?b.createObjectURL(a):!1}function d(a){return b?b.revokeObjectURL(a):!1}function e(a,b){if(window.FileReader&&FileReader.prototype.readAsDataURL){var c=new FileReader;return c.onload=function(a){b(a.target.result)},c.readAsDataURL(a),c}return!1}var b=window.createObjectURL&&window||window.URL||window.webkitURL;return a}),define("tags/img",["value","helpers","hook","template","loadImage"],function(a,b,c,d,e){function f(f){this.hidden=f.hidden,this.data=a({}),this.inputId=_.uniqueId("gofer"),this.imgId=_.uniqueId("gofer"),this.src=a(""),this.src.subscribe(_.bind(function(a){this.data.update("src",a)},this)),this.title=a(),this.title.subscribe(_.bind(function(a){this.data.update("title",a)},this))(f.title),f.mix&&this.data.modify(b(f.mix)),this.note=f.note,f.required&&c("submit",_.bind(function(){return this.src()},this)),c("dom",_.bind(function(a){var b=$("#"+this.imgId);a.on("change","#"+this.inputId,function(a){e(a.target.files[0],function(a){b.html(a)})})},this)),d("img",'<% if(note) { %><div class="gofer-note"><%= note %></div><% } %><div id="<%= imgId %>"></div><input type="file" accept="image/*" id="<%= inputId %>">')}return _.extend(f.prototype,{edit:function(a){return d("img",this)},view:function(){return this.hidden?"":'<img src="'+this.src()+'">'}}),f}),define("tags/link",["value","helpers","hook","template"],function(a,b,c,d){function e(e){this.htmlAttributes=e.htmlAttributes,this.id=_.uniqueId("gofer"),this.buttonId=_.uniqueId("gofer"),this.hrefId=_.uniqueId("gofer"),this.data=a({}),this.text=a(""),this.text.subscribe(_.bind(function(a){this.data.update("text",a)},this)),this.href=a(),this.href.subscribe(_.bind(function(a){this.data.update("href",a)},this))(e.href),e.mix&&this.data.modify(b(e.mix)),this.hidden=e.hidden,this.note=e.note,e.required&&c("submit",_.bind(function(){return this.text()&&this.href()},this)),c("dom",_.bind(function(){var a=$("#"+this.id).on("keyup",_.bind(function(){this.text(a.val())},this)),b=$("#"+this.hrefId).on("keyup",_.bind(function(){this.href(b.val())},this));$("#"+this.buttonId).on("click",function(){b.toggle()})},this)),d("link",'<% if(note) { %> <div class="gofer-note"><%= note %></div><% } %><input type="text" id="<%= id %>" value="<%= text() %>" <%= htmlAttributes %> ><input type="button" id="<%= buttonId %>"><input type="text" id="<%= hrefId %>" value="<%= href() %>">')}return _.extend(e.prototype,{edit:function(a){return d("link",this)},view:function(){return this.hidden?"":'<a href="'+this.href()+'" title="">'+this.text()+"</a>"}}),e}),define("tags/index",["tags","tags/input","tags/note","tags/img","tags/link"],function(a,b,c,d,e){a.register({input:b,note:c,link:e,img:d})});var JSON;JSON||(JSON={}),function(){function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";return e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]=="string"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));return e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("../libs/json2",function(){}),require.config({baseUrl:"../src"}),require(["lexer","parser","template","value","hook","helpers","id","tags","tags/index","../libs/json2"],function(a,b,c,d,e,f,g,h){function i(a){if(typeof a!="string"){if($.isPlainObject(a))return j=_.defaults(a,j),l(),i;if(!a)return l(),i;throw new Error("invalid arguments")}console.log("implement find by #ID here...")}function l(){j.success&&i.slugs.header.modify(function(a){return'<div class="gofer-success">SUCCESS!</div>'+a}),j.data&&e("dom",function(){i.data(j.data)}),i.$container=$(j.container),$.get(j.template,function(b){k=a(b),e("dom",function(){$("#gofer-submit").click(function(a){a.preventDefault(),i.submit()})}),i.render()})}_.extend(i,{template:c,value:d,hook:e,helpers:f,registerTags:h.register,$container:null});var j={template:"./template.html",dataUrl:"./goferData",postUrl:".",container:"body",mode:"edit",uploadDir:"uploads",data:!1,success:!1};i.settings=function(){return j};var k;i.render=function(){var a=j.mode;i.$container.html((a==="edit"?i.slugs.header():"")+b(k.slice(),a)+(a==="edit"?i.slugs.footer():"")).promise().done(function(){e("dom",i.$container)})},i.data=function(a){if(!a){var b={};return _.each(g.cache,function(a,c){b[c]=a.data()}),JSON.stringify(b)}_.each(JSON.parse(a),function(a,b){_.each(a,function(a,c){g.update(b,c,a)})})},i.mode=function(a){if(!(!a||a in["edit","view"])){console.log("Invalid mode.\nValid modes: 'edit', 'view'");return}j.mode=j.mode==="edit"?"view":"edit",i.render()},i.generateOutput=function(){var a=$("html").clone();return a.find(j.container).html(b(k.slice(),"view")),"<html>"+a.html().replace(/<!--\s*?gofer\s*?-->[\s\S]*?(<!--\s*?\/\s*?gofer\s*?-->)/,"")+"</html>"},i.slugs={header:d('<form id="gofer-form" method="post">'),footer:d('<input type="submit" id="gofer-submit"></form>')},i.getTemplate=function(){return _.reduce(k,function(a,b){return a+(_.isString(b)?b:"{{"+b.temp+"}}")},"")},c("hidden-field",'<input type="hidden" name="<%- name %>" value="<%- value %>">'),i.submit=function(){if(e("submit")){var a={output:i.generateOutput(),fields:i.data()};$("#gofer-form").append(_.reduce(a,function(a,b,d){return a+c("hidden-field",{name:d,value:b})},"")),$("#gofer-form").submit()}},window.gofer=i(window.gofer)}),define("gofer",function(){})})()