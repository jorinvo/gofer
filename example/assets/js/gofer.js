(function(){define("parser",[],function(){function a(a,b){function c(d,e){var f=a.pop();return _.isUndefined(f)?"":f.isClosingTag?c(f.name,[]):d?d===f.name?c()+f.object[b](function(){return _.reduce(e,function(a,c){return a+(_.isString(c)?c:c.object[b].call(c.object))},"")}):(e.unshift(f),c(d,e)):c()+(_.isString(f)?f:f.object[b]())}return c().replace("{\\{","{{").replace("}\\}","}}")}return a}),define("template",["jquery"],function(a){function b(){var b=arguments;if(_.isUndefined(b[0]))return _.keys(c);if(a.isPlainObject(b[0])){var d=b[0];if(_.isString(_.values(d)[0])){_.each(d,function(a,b){d[b]=_.template(a)}),_.extend(c,d);return}return _.each(d,function(a,b){d[b]=c[b](a)}),d}if(_.isObject(b[1]))return c[b[0]](b[1]);if(_.isUndefined(b[1]))return c[b[0]];c[b[0]]=_.template(b[1]);if(b[2])return c[b[0]](b[2])}var c={};return b}),define("manage",[],function(){function a(a,b){var c=_.reject(a,function(a){return a===b});return c.length===a.length?a.push(b):a=c,a}return a}),define("value",["manage"],function(a){function b(b){function c(a){return _.isUndefined(a)||(f=a,e()),d()}function d(){return _.compose.apply(this,g)(f)}function e(){var a=d();_.each(h,function(b){b(a)})}var f=b,g=[],h=[];return _.extend(c,{modify:function(b){return g=a(g,b),this},subscribe:function(b){return h=a(h,b),this},trigger:function(){return e(),this},update:function(a){var b=arguments;return _.isArray(f)?b.length===2&&(_.isNumber(b[0])||_.isNumber(parseInt(b[0],10)))?f[b[0]]=b[1]:f=f.concat(_.isArray(a)?a:Array.prototype.slice.call(b)):_.isObject(f)?_.isUndefined(b[1])?_.isArray(a)?f[a[0]]=a[1]:_.extend(f,a):f[b[0]]=b[1]:f+=a,e(),this}}),c}return b}),define("hook",["manage"],function(a){function b(d,e){if(_.isFunction(e))return c[d]=c[d]?a(c[d],e):[e],b;var f=!0;return _.each(c[d],function(a){a(e)||(f=!1)}),f}var c={};return b}),define("helpers",["jquery"],function(a){function b(b){if(!a.isPlainObject(b))return c[b];_.defaults(c,b)}var c={};return b.overwrite=function(a){_.extend(c,a)},b}),define("tags",[],function(){var a={register:function(b){a.cache=_.defaults(a.cache,b)},cache:{}};return a}),define("id",["jquery","value","template","hook","tags"],function(a,b,c,d,e){function f(e){this.data=b(),f.subscribe(e,_.bind(this.data,this)),this.id=_.uniqueId("gofer"),d("dom",_.bind(function(){this.data.subscribe(_.bind(function(){a("."+this.id).html(this.content())},this))},this)),c("id",'<div class="<%= id %>"><%= content() %></div>')}function g(){}return _.extend(f.prototype,{edit:function(a){return a?this.content=function(){return _.reduce(this.data(),function(b,c){return b+a().replace(/\{\{el\}\}/,c)},"")}:this.content=function(){return _.reduce(this.data(),function(a,b){return a+b},"")},c("id",this)},view:function(a){return this.content()}}),f.cache={},f.subscribe=function(a,c){f.cache[a]?c(f.cache[a]()):f.cache[a]=b([]),f.cache[a].subscribe(c)},f.add=function(a,c){f.cache[a]||(f.cache[a]=b([]));var d=f.cache[a]().push(c.data())-1;c.data.subscribe(function(b){f.cache[a].update(d,b)})},_.extend(g.prototype,{edit:function(){return"{{el}}"},view:function(){return"{{el}}"}}),e.register({el:g}),f}),define("lexer",["jquery","id","tags"],function(a,b,c){function d(d){return _.map(d.split(/\{\{|\}\}/),function(d,e){if(e%2!==0){var f={temp:a.trim(d)},g={},h=f.temp.match(/\S+\(.*?\)|\S+=".*?"|\S+/g),i,j;f.name=h.shift();var k=f.name.match(/(.+?)\((.*?)\)/);if(i=f.name.match(/\/(.+)/))return f.isClosingTag=!0,f.name=i[1],f;if(j=f.name.match(/#(.+)/))return f.isId=!0,f.name=j[1],f.object=new b(f.name),f;k&&(f.name=k[1],g.param=k[2]),g.htmlAttributes="";var l;return _.each(h,function(a){var b;if(/#(.+)/.test(a))return l=a.match(/#(.+)/)[1];(b=a.match(/(.+?)\((.*?)\)/))?g[b[1]]=b[2]:/.+?".*?"/.test(a)?g.htmlAttributes+=" "+a:g[a]=!0}),f.object=new c.cache[f.name](g),l&&b.add(l,f.object),f}return d})}return d}),define("tags/input",["jquery","value","helpers","hook","template"],function(a,b,c,d,e){function f(f){this.id=_.uniqueId("gofer"),this.data=b(""),this.data.modify(_.escape),this.dataOut=f.mix?function(){return c(f.mix)(this.data())}:this.data,this.hidden=f.hidden,this.note=f.note,f.required&&d("submit",_.bind(function(){return this.data()},this)),d("dom",_.bind(function(){var b=a("#"+this.id).on("keyup",_.bind(function(){this.data(b.val())},this))},this)),e("input",'<% if(note) { %>  <label class="gofer"><%= note %></label><% } %><input type="text" value="<%= data() %>" id="<%= id %>" class="gofer">')}return _.extend(f.prototype,{edit:function(){return e("input",this)},view:function(){return this.hidden?"":this.dataOut()}}),f}),define("tags/note",[],function(){function a(){}return _.extend(a.prototype,{edit:function(a){return a()},view:function(){return""}}),a}),define("loadImage",[],function(){function a(a,e){var f=document.createElement("img"),g,h;return f.onerror=e,f.onload=function(){h&&c(h),e(f)},window.File&&a instanceof File?g=h=b(a):g=a,g?(f.src=g,f):d(a,function(a){f.src=a})}function b(a){return e?e.createObjectURL(a):!1}function c(a){return e?e.revokeObjectURL(a):!1}function d(a,b){if(window.FileReader&&FileReader.prototype.readAsDataURL){var c=new FileReader;return c.onload=function(a){b(a.target.result)},c.readAsDataURL(a),c}return!1}var e=window.createObjectURL&&window||window.URL||window.webkitURL;return a}),define("tags/img",["jquery","value","helpers","hook","template","loadImage"],function(a,b,c,d,e,f){function g(g){this.hidden=g.hidden,this.data=b({}),this.inputId=_.uniqueId("gofer"),this.imgId=_.uniqueId("gofer"),this.src=b(""),this.src.subscribe(_.bind(function(a){this.data.update("src",a)},this)),this.title=b(),this.title.subscribe(_.bind(function(a){this.data.update("title",a)},this))(g.title),g.mix&&this.data.modify(c(g.mix)),this.note=g.note,g.required&&d("submit",_.bind(function(){return this.src()},this)),d("dom",_.bind(function(b){var c=a("#"+this.imgId);b.on("change","#"+this.inputId,function(a){f(a.target.files[0],function(a){c.html(a)})})},this)),e("img",'<% if(note) { %><div class="gofer-note"><%= note %></div><% } %><div id="<%= imgId %>"></div><input type="file" accept="image/*" id="<%= inputId %>">')}return _.extend(g.prototype,{edit:function(a){return e("img",this)},view:function(){return this.hidden?"":'<img src="'+this.src()+'">'}}),g}),define("tags/link",["jquery","value","helpers","hook","template"],function(a,b,c,d,e){function f(f){this.htmlAttributes=f.htmlAttributes,this.id=_.uniqueId("gofer"),this.buttonId=_.uniqueId("gofer"),this.hrefId=_.uniqueId("gofer"),this.data=b({}),this.text=b(""),this.text.subscribe(_.bind(function(a){this.data.update("text",a)},this)),this.href=b(),this.href.subscribe(_.bind(function(a){this.data.update("href",a)},this))(f.href),f.mix&&this.data.modify(c(f.mix)),this.hidden=f.hidden,this.note=f.note,f.required&&d("submit",_.bind(function(){return this.text()&&this.href()},this)),d("dom",_.bind(function(){var b=a("#"+this.id).on("keyup",_.bind(function(){this.text(b.val())},this)),c=a("#"+this.hrefId).on("keyup",_.bind(function(){this.href(c.val())},this));a("#"+this.buttonId).on("click",function(){c.toggle()})},this)),e("link",'<% if(note) { %> <div class="gofer-note"><%= note %></div><% } %><input type="text" id="<%= id %>" value="<%= text() %>" <%= htmlAttributes %> ><input type="button" id="<%= buttonId %>"><input type="text" id="<%= hrefId %>" value="<%= href() %>">')}return _.extend(f.prototype,{edit:function(a){return e("link",this)},view:function(){return this.hidden?"":'<a href="'+this.href()+'" title="">'+this.text()+"</a>"}}),f}),define("tags/index",["tags","tags/input","tags/note","tags/img","tags/link"],function(a,b,c,d,e){a.register({input:b,note:c,link:e,img:d})}),require.config({paths:{jquery:"http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min"},baseUrl:"../src"}),require(["jquery","lexer","parser","template","value","hook","helpers","tags","tags/index"],function(a,b,c,d,e,f,g,h){function i(b){if(typeof b!="string"){if(a.isPlainObject(b))return j=_.defaults(b,i.settings()),l(),i;if(!b)return l(),i;throw new Error("invalid arguments")}console.log("implement find by #ID here...")}function l(){a.get(i.settings().template,function(c){k=b(c),f("dom",function(){a("#gofer-submit").click(function(a){f("submit")||a.preventDefault()})}),i.render()})}_.extend(i,{template:d,value:e,hook:f,helpers:g,registerTags:h.register});var j={template:"./index.gofer",dataUrl:"/goferData",postUrl:"/",updateTemplateUrl:!1,container:"body",mode:"edit"};i.settings=function(){return j};var k;i.render=function(){var b=i.settings().mode,d=a(i.settings().container);d.html((b==="edit"?i.slugs.header():"")+c(k.slice(),b)+(b==="edit"?i.slugs.footer():"")).promise().done(function(){f("dom",d)})},i.mode=function(a){if(!(!a||a in["edit","view"])){console.log("Invalid mode.\nValid modes: 'edit', 'view'");return}j.mode=i.settings().mode==="edit"?"view":"edit",i.render()},i.generateOutput=function(){var b=a("html").clone();return b.find(i.settings().container).html(c(k.slice(),"view")),b.html().replace(/<!--\s*?gofer\s*?-->[\s\S]*?(<!--\s*?\/\s*?gofer\s*?-->)/,"")},i.slugs={header:e('<form method="post">'),footer:e('<input type="submit" id="gofer-submit"></form>')},i.getTemplate=function(){return _.reduce(k,function(a,b){return a+(_.isString(b)?b:"{{"+b.temp+"}}")},"")},window.gofer=i(window.gofer)})})()